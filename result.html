<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConnectCode マッチングプロトタイプ</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 20px; background-color: #f0f2f5; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); max-width: 700px; margin: auto; }
        h1 { color: #24292e; border-bottom: 2px solid #e1e4e8; padding-bottom: 10px; margin-bottom: 20px; }
        h2 { color: #0366d6; margin-top: 25px; }
        label { display: block; margin-top: 15px; font-weight: 600; color: #586069; }
        input[type="number"] { width: 80px; padding: 6px; border: 1px solid #d1d5da; border-radius: 6px; text-align: right; margin-left: 10px; }
        button { background-color: #2ea44f; color: white; padding: 10px 15px; border: none; border-radius: 6px; cursor: pointer; margin-top: 20px; font-size: 16px; width: 100%; transition: background-color 0.2s; }
        button:hover { background-color: #22863a; }
        .skill-input-group { display: flex; align-items: center; justify-content: space-between; padding: 5px 0; }
        #results { margin-top: 30px; padding: 20px; border: 1px solid #d1d5da; border-radius: 6px; background-color: #f6f8fa; }
        .match-item { border-bottom: 1px solid #e1e4e8; padding: 10px 0; display: flex; justify-content: space-between; }
        .match-score { font-weight: bold; color: #2ea44f; font-size: 1.1em; }
    </style>
</head>
<body>

<div class="container">
    <h1>ConnectCode マッチングシミュレーター</h1>
    <p>あなたのスキルレベル (0〜100) を入力し、仮想プロジェクトとの相性を計算します。</p>

    <h2>あなたのスキル (0-100)</h2>
    <div id="skill-inputs">
        <div class="skill-input-group">
            <label>JavaScript/TypeScript:</label>
            <input type="number" id="skill_js" value="80" min="0" max="100">
        </div>
        <div class="skill-input-group">
            <label>Backend (Go/Python):</label>
            <input type="number" id="skill_backend" value="50" min="0" max="100">
        </div>
        <div class="skill-input-group">
            <label>DevOps (AWS/Docker):</label>
            <input type="number" id="skill_devops" value="30" min="0" max="100">
        </div>
        <div class="skill-input-group">
            <label>Design/UX:</label>
            <input type="number" id="skill_design" value="10" min="0" max="100">
        </div>
        <div class="skill-input-group">
            <label>Recent Activity (10-100, コミット頻度):</label>
            <input type="number" id="activity" value="90" min="10" max="100">
        </div>
    </div>

    <button onclick="runMatching()">マッチング開始</button>

    <div id="results">
        マッチング結果がここに表示されます。
    </div>
</div>

<script>
    // 仮想のプロジェクトデータ (求めるスキルレベル 0-100)
    // 実際にはデータベースから取得されます。
    const VIRTUAL_PROJECTS = [
        { 
            id: 1, 
            name: "次世代Webエディタ開発 (TypeScript強め)", 
            requiredSkills: { js: 95, backend: 40, devops: 20, design: 70 },
            activityWeight: 0.8
        },
        { 
            id: 2, 
            name: "高性能APIサーバー構築 (Go/Rust経験必須)", 
            requiredSkills: { js: 10, backend: 90, devops: 80, design: 5 },
            activityWeight: 0.95
        },
        { 
            id: 3, 
            name: "スタートアップのMVP開発 (フルスタック)", 
            requiredSkills: { js: 60, backend: 60, devops: 50, design: 40 },
            activityWeight: 0.7
        },
    ];

    /**
     * コサイン類似度を計算する関数 (マッチングのコアロジック)
     * ベクトルAとベクトルBの類似度を0.0 (無関係) から 1.0 (完全一致) で返します。
     * @param {Object} vecA - ユーザーのスキルベクトル
     * @param {Object} vecB - プロジェクトの要求スキルベクトル
     * @returns {number} コサイン類似度
     */
    function calculateCosineSimilarity(vecA, vecB) {
        const skills = Object.keys(vecA);
        let dotProduct = 0;
        let magnitudeA = 0;
        let magnitudeB = 0;

        for (const skill of skills) {
            dotProduct += vecA[skill] * vecB[skill];
            magnitudeA += vecA[skill] ** 2;
            magnitudeB += vecB[skill] ** 2;
        }

        magnitudeA = Math.sqrt(magnitudeA);
        magnitudeB = Math.sqrt(magnitudeB);

        if (magnitudeA === 0 || magnitudeB === 0) {
            return 0; // どちらかのベクトルがゼロの場合は類似度ゼロ
        }

        // コサイン類似度の計算: (A・B) / (|A| * |B|)
        return dotProduct / (magnitudeA * magnitudeB);
    }

    /**
     * メインのマッチング処理を実行する関数
     */
    function runMatching() {
        // ユーザー入力の取得
        const userSkills = {
            js: parseInt(document.getElementById('skill_js').value) || 0,
            backend: parseInt(document.getElementById('skill_backend').value) || 0,
            devops: parseInt(document.getElementById('skill_devops').value) || 0,
            design: parseInt(document.getElementById('skill_design').value) || 0,
        };
        const userActivity = parseInt(document.getElementById('activity').value) || 0;
        
        const resultsDiv = document.getElementById('results');
        let resultsHTML = '<h2>マッチング結果</h2>';

        // 各プロジェクトとのマッチングスコアを計算
        const matches = VIRTUAL_PROJECTS.map(project => {
            // 1. コサイン類似度によるスキル相性の計算
            const similarity = calculateCosineSimilarity(userSkills, project.requiredSkills);
            
            // 2. アクティビティによる補正（w2 * log(Recent Commits) の簡易版）
            // ユーザーのアクティビティとプロジェクトの要求する活動重みを考慮
            // 0.2は重み付けの係数として使用
            const activityBonus = 0.2 * (userActivity / 100) * project.activityWeight; 
            
            // 3. 最終マッチスコアの計算 (0-100点に換算)
            // Score = (Similarity * 0.8 + ActivityBonus * 0.2) * 100
            let matchScore = (similarity * 0.8 + activityBonus * 0.2) * 100;
            
            // スコアを小数点以下を四捨五入して整数にする
            matchScore = Math.round(matchScore);

            return {
                name: project.name,
                score: matchScore
            };
        }).sort((a, b) => b.score - a.score); // スコアの高い順にソート

        // 結果のHTML生成
        if (matches.length === 0) {
            resultsHTML += '<p>マッチングするプロジェクトが見つかりませんでした。</p>';
        } else {
            matches.forEach(match => {
                resultsHTML += `
                    <div class="match-item">
                        <span>${match.name}</span>
                        <span class="match-score">${match.score} 点</span>
                    </div>
                `;
            });
        }
        
        resultsDiv.innerHTML = resultsHTML;
    }
</script>

</body>
</html>
